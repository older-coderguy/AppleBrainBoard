0001   0000             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0002   0000             ; $Id: Worksv8.asm 1.0 12/22/2025  12:28PM 
0003   0000             ; Author: Leslie Newman
0004   0000             ;
0005   0000             ; Load DOS 3.3 into Apple II+ ram on boot.
0006   0000             ;
0007   0000             ; Hot keys-
0008   0000             ; Control M = Load DOS, enter the monitor.
0009   0000             ; Control C = load DOS, catalog disk.
0010   0000             ; Control B = Load DOS, display prompt.
0011   0000             ;
0012   0000             ; Telemark Assembler (TASM) version 3.2
0013   0000             ; Using an old dos program Bintel.com to convert hex file generated by tasm
0014   0000             ; to the correct format hex and binary files that my eprom programmer can use.
0015   0000             ;
0016   0000             ;
0017   0000             ;REVISION: 1-3-2026
0018   0000             ; ADD TO THE PROGRAM LOADED AT $1000 TO CALL $FB60 THAT PRINTS
0019   0000             ; APPLE ][.
0020   0000             ;
0021   0000             ;REVISION: 1-19-2026
0022   0000             ; FIXED HOT KEYS SO THAT CATALOG AND MONITOR ENTRY WORKS.
0023   0000             ;
0024   0000             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0025   0000             
0026   0000             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0027   0000             ; 
0028   0000             ; RESET ROUTINE FOR DOS HOSS running in II+
0029   0000             ; Processor: 6502
0030   0000             ;
0031   0000             ; THIS CODE SET FOR DOS HOSS IN SLOT 4
0032   0000             ; This code must be loaded at $1000 in the EPROM. That works out as
0033   0000             ; $D000 in the Brain Board. Make sure that the F8 ROM reset vestor at FFFC-FFFD
0034   0000             ; Points to $D800 on power up or reset of the Apple II.
0035   0000             ;
0036   0000             ; THESE ARE HANDY DEFINES FOR THE COMPILER
0037   0000             ;
0038   0000             #define EQU     .EQU
0039   0000             #define ORG     .ORG
0040   0000             #define RMB     .BLOCK
0041   0000             #define FCB     .BYTE
0042   0000             #define FCC     .TEXT
0043   0000             #define FDB     .WORD
0044   0000             #define	DW	.WORD	;define word
0045   0000             #define DFB	.BYTE	;define byte
0046   0000             #define equ     .EQU
0047   0000             #define org     .ORG
0048   0000             #define rmb     .BLOCK
0049   0000             #define fcb     .BYTE
0050   0000             #define fcc     .TEXT
0051   0000             #define fdb     .WORD
0052   0000             #define dfb	.BYTE
0053   0000             #define	END	.END
0054   0000             #define HOFFLOW	#$C1	;This is the slot number of Brain Board
0055   0000             			;low byte $C1 = Slot 4
0056   0000             			;low byte $D1 = Slot 5
0057   0000             			;using #define to assign the variable name to a HEX value
0058   0000             ;
0059   0000             ;
0060   0000             ; These equates are used by the Move Dos routine
0061   0000             ;
0062   0000             SRCE		EQU	$6
0063   0000             SRCEHI		EQU	$7
0064   0000             DSTN		EQU	$8
0065   0000             DSTNHI		EQU	$9
0066   0000             MOVEP3		EQU	$9E25
0067   0000             RTSTEMP		EQU	$9E41
0068   0000             
0069   0000             ;
0070   0000             ; These equates are used by the main DosHoss initialization code
0071   0000             ;
0072   0000             COUNT		equ	$300	;USE AS A COUNTER WHEN NEEDED
0073   0000             INVFLG		EQU	$32	;SET TO $FF FOR NORMAL VIDEO
0074   0000             PROMPT		EQU	$33
0075   0000             CSWL		EQU	$36
0076   0000             A1L		EQU	$3C
0077   0000             A1H		EQU	$3D
0078   0000             A2L		EQU	$3E
0079   0000             A2H		EQU	$3F
0080   0000             A4L		EQU	$42
0081   0000             A4H		EQU	$43
0082   0000             BFFRFLG		EQU	$45
0083   0000             ONERR		EQU	$D8
0084   0000             DOSWARM		EQU	$3D0
0085   0000             DOSWRMHI	EQU	$3D
0086   0000             DOSWRMLO	EQU	$00
0087   0000             PWRUP		EQU	$3F4	;THIS IS PWREDUP HOLDS RANDOM VALUE IF A POWER UP
0088   0000             SAVEPWRUP	EQU	$2000	;THIS IS PWREDUP HOLDS RANDOM VALUE IF A POWER UP
0089   0000             ALLMENUS	EQU	$2100
0090   0000             CATALOG		EQU	$A56E
0091   0000             CATALOGHI	EQU	$A5	;Catalog disk
0092   0000             CATALOGLO	EQU	$6E	;Catalog disk
0093   0000             DOSCSWL		EQU	$AA53	;DOS output hook. Default is $FDF0
0094   0000             DOSCMDX		EQU	$AA5F	;DOS 3.2/3.3 Command number
0095   0000             DOSSTRT		EQU	$B73A	;
0096   0000             READKEY		EQU	$C000	;Peek to read keyboard. Value > 127 means a key has been pressed.
0097   0000             KEYSTROBE	EQU	$C010	;Keyboard strobe. WRITE TO CLEAR STROBE.
0098   0000             SAVEKEY		EQU	$2001	;SAVE THE LAST KEY PRESSED
0099   0000             SPEAKER		EQU	$C030	;ONLY READ LOCATION $C030. SATHER DID AN STA IN HIS ORIGINAL CODE
0100   0000             AN0OFF		EQU	$C058	;Poke 0 to Clear game AN0
0101   0000             AN1OFF		EQU	$C05A	;Poke 0 to Clear game AN1
0102   0000             OPENAPL		EQU	$C061	;*** NOT IN II+
0103   0000             SLDAPL		EQU	$C062	;*** NOT IN II+
0104   0000             RDONLY		EQU	$C080	;Write PROTECT RAM. Select 2nd bank of $D000 - $DFFF RAM in language card.
0105   0000             				;$C084 does the same as $C080.
0106   0000             WRTONLY		EQU	$C081	;Write ENABLE RAM. in II+ DOS 3.2 Read_Write track sector and also 
0107   0000             				;Read-Deselect 2nd bank of $D000 - $DFFF RAM in language card. 
0108   0000             HRAMOFF		EQU	$C082	;Write PROTECT RAM. in II+ DOS 3.2 Read_Write track sector and also
0109   0000             				;Read-Deselect 2nd bank of $D000 - $DFFF RAM in language card.
0110   0000             ;HOSSOFF	EQU	$C0D1	;EXIT THE DOSHOSS ROM to Motherboard for slot 5
0111   0000             ;BANK1		EQU	$C0D2	;This switched to the upper bank of ROM ** no longer used by my code
0112   0000             HOSSOFF		EQU	$C0C1	;EXIT THE DOSHOSS ROM to Motherboard FOR SLOT 4 !! CURRENTLY NOT USED
0113   0000             BANK1		EQU	$C0C2	;This switched to the upper bank of ROM ** no longer used by my code
0114   0000             CLRROM		EQU	$CFFF	;Turn off Flip Flops. Disable expansion ROM
0115   0000             BASIC		EQU	$DFFF	;*** Looks like garbage in the II+.
0116   0000             NRESET		EQU	$FA62	;Normal Reset Vector for II+ (IIe is $FA61)
0117   0000             INIT		EQU	$FB2F	;Screen init. Reset Text mode
0118   0000             TEXTMODE	EQU	$FB39	;TEXT MODE JUST LIKE BASIC
0119   0000             GOTOCX		EQU	$FBB4	;*** Monitor memory location MD3.In new F8 ROM code here saves ROM states
0120   0000             HOME		EQU	$FC58	;HOME. Clear screen. Cursor top left
0121   0000             WAIT		EQU	$FCA8	;Call Wait loop. Set A register with calculation value
0122   0000             MOVE		EQU	$FE2C	;monitor memory move
0123   0000             SETNORM		EQU	$FE84	;Set video output to normal
0124   0000             MONITOR		EQU	$FF58	;JSR here to find out where one is. Sets Overflow flag.
0125   0000             NMIDSTN		EQU	$FFFA	;Address of NMI (Non-Maskable interupt) vector
0126   0000             ;
0127   0000             ;
0128   0000             ; 
0129   0000             ;
0130   0000             ;  BANK 0 ROUTINES
0131   0000             ;
0132   0000             ;  
0133   0000             ;
0134   0000             ; ** Note: I did not include Integer Basic. There was no room in the Brain Board
0135   0000             ;          to fit Integer and Dos 3.3. All I really wanted was to have DOS load
0136   0000             ;          instantly on power up. An idea for the future is to have a assembly routine
0137   0000             ;	   do some bank switching and load the Integer Basic from the upper ROM area.
0138   0000             ;	   I think this would work.
0139   0000             ;
0140   0000             ; HOT KEYS-
0141   0000             ;
0142   0000             ; CONTROL + C WILL CATALOG THE DISK
0143   0000             ; CONTROL + M WILL ENTER THE MONITOR
0144   0000             ; CONTROL + B LOADS DOS AGAIN AFTER INITIAL BOOT
0145   0000             ;
0146   0000             ;
0147   D000             		.ORG	$D000
0148   D000 4C 6F D0    		JMP	_MENUS
0149   D003             ;
0150   D003             ;
0151   D003             ; Some future menus that can be displayed on power up.
0152   D003             ;
0153   D003 44 4F 53 20 MENU_1	.TEXT	"DOS 3.3 HAS BEEN LOADED!\n"
0153   D007 33 2E 33 20 
0153   D00B 48 41 53 20 
0153   D00F 42 45 45 4E 
0153   D013 20 4C 4F 41 
0153   D017 44 45 44 21 
0153   D01B 0A 
0154   D01C 43 4F 4E 54 MENU_2	.TEXT	"CONTROL + C = CATALOG DISK.\n"
0154   D020 52 4F 4C 20 
0154   D024 2B 20 43 20 
0154   D028 3D 20 43 41 
0154   D02C 54 41 4C 4F 
0154   D030 47 20 44 49 
0154   D034 53 4B 2E 0A 
0155   D038 43 4F 4E 54 MENU_3	.TEXT	"CONTROL + M = ENTER MONITOR.\n"
0155   D03C 52 4F 4C 20 
0155   D040 2B 20 4D 20 
0155   D044 3D 20 45 4E 
0155   D048 54 45 52 20 
0155   D04C 4D 4F 4E 49 
0155   D050 54 4F 52 2E 
0155   D054 0A 
0156   D055 43 4F 4E 54 MENU_4	.TEXT	"CONTROL + B = RELOAD DOS.\n"
0156   D059 52 4F 4C 20 
0156   D05D 2B 20 42 20 
0156   D061 3D 20 52 45 
0156   D065 4C 4F 41 44 
0156   D069 20 44 4F 53 
0156   D06D 2E 0A 
0157   D06F             ;
0158   D06F             ;
0159   D06F             ;**********************************************************
0160   D06F             ;
0161   D06F             ;	BEGIN RESET HANDLER
0162   D06F             ; RESET VECTOR IS FFFC AND FFFD. THIS CODE BEGINS AT $D000.
0163   D06F             ; ON POWER UP, THE F8 ROM RESET VECTOR HAS FFFC-FFFD LOADED WITH D000
0164   D06F             ; SO THE CPU VECTORS TO THIS PROGRAM. ONCE DOS HAS BEEN LOADED INTO THE APPLE RAM
0165   D06F             ; THIS PROGRAM PLACES A SHORT ASSEMBLER ROUTINE AT $1000 IN THE APPLE MEMORY. THIS ROUTUINE
0166   D06F             ; TURNS OFF THE BRAIN BOARD AND THEN DOES SOME RESET STUFF. IT ALSO CHECKS
0167   D06F             ; FOR THE HOT KEYS TO CATALOG DISK OR GO INTO THE MONITOR.
0168   D06F             ; THIS ROUTINE CHANGES HOW SATHER DID THE EXIT. HIS DOSHOSS WAS EXPECTING AN RTS
0169   D06F             ; TO BE AT A MOTHERBOARD ROM LOCATION AFTER THE DOSHOSS WAS TURNED OFF. IT SEEMS MORE
0170   D06F             ; FLEXIBLE TO HAVE A PROGRAM RUNNING IN THE APPLE MEMORY THAT TURNS OFF THE BRAIN BOARD AND
0171   D06F             ; CAN THEN CLEAN UP REGISTERS, CLEAR SCREEN AND COMPLETE THE BOOT.
0172   D06F             ;
0173   D06F             ;  
0174   D06F             ; MOVE THE STRINGS INTO MEMORY AT $2100
0175   D06F             ;
0176   D06F             ;
0177   D06F A2 FF       _MENUS		LDX	#$FF	;USE X AS COUNTER. SHOULD NEVER REACH $FF COUNT.
0178   D071 A0 00       		LDY	#$00	;USE Y AS MEMORY OFFSET AND GRAB STRING.
0179   D073 A9 00       		LDA	#$00
0180   D075 8D 00 03    		STA	COUNT
0181   D078 B9 03 D0    _MENU1		LDA	MENU_1,Y
0182   D07B C9 0A       		CMP	#$0A	;WAS IT LINEFEED?
0183   D07D F0 0C       		BEQ	_ALLDONE
0184   D07F 99 00 21    		STA	ALLMENUS,Y
0185   D082 EE 00 03    		INC	COUNT
0186   D085 C8          		INY
0187   D086 CA          		DEX
0188   D087 E0 FF       		CPX	#$FF
0189   D089 D0 ED       		BNE	_MENU1
0190   D08B 99 00 21    _ALLDONE	STA	ALLMENUS,Y
0191   D08E C8          		INY
0192   D08F A9 00       		LDA	#$00
0193   D091 99 00 21    		STA	ALLMENUS,Y	;PUT ZEROS AS END OF STRING MARKER
0194   D094 4C C3 D0    		JMP	_NOBUTTN
0195   D097             ;
0196   D097             ;
0197   D097 57 4F 52 4B _VERSION	.TEXT	"WORKSV8.ASM 1-2026 Author: Leslie Newman"
0197   D09B 53 56 38 2E 
0197   D09F 41 53 4D 20 
0197   D0A3 31 2D 32 30 
0197   D0A7 32 36 20 41 
0197   D0AB 75 74 68 6F 
0197   D0AF 72 3A 20 4C 
0197   D0B3 65 73 6C 69 
0197   D0B7 65 20 4E 65 
0197   D0BB 77 6D 61 6E 
0198   D0BF             ;
0199   D0BF BD 9E       _DOSLINK	.WORD	$9EBD
0200   D0C1 81 9E       		.WORD	$9E81
0201   D0C3             ;
0202   D0C3             ;
0203   D0C3 AD F3 03    _NOBUTTN	LDA	PWRUP-1		;LOAD POWER UP STATUS
0204   D0C6 49 A5       		EOR	#$A5		;
0205   D0C8 CD F4 03    		CMP	PWRUP
0206   D0CB 8D F4 03    		STA	PWRUP
0207   D0CE 8D 00 20    		STA	SAVEPWRUP	;CURIOUS ABOUT THE LAST KEY PRESSED
0208   D0D1 D0 0E       		BNE 	_DOHOSS		;BRANCH IF NOT A POWER UP
0209   D0D3 AD 00 C0    		LDA	READKEY		;CHECK FOR KEYPRESS
0210   D0D6 8D 01 20    		STA	SAVEKEY		;SAVE LAST KEY PRESSED
0211   D0D9 AD 10 C0    		LDA	KEYSTROBE	;RESET KEYBOARD STROBE
0212   D0DC AD 01 20    		LDA	SAVEKEY		;CHECK IF A KEY WAS PRESSED. HIGH BIT CLEAR
0213   D0DF 30 6E       		BMI	_DONORM		;NO KEY DOWN, NOT A POWER UP
0214   D0E1 A2 FF       _DOHOSS		LDX	#$FF
0215   D0E3 9A          		TXS
0216   D0E4 D8          		CLD
0217   D0E5 20 84 FE    		JSR	SETNORM		;DO A BIUNCH OF RESET STUFF
0218   D0E8 20 2F FB    		JSR	INIT
0219   D0EB 20 58 FC    		JSR	HOME
0220   D0EE AD 58 C0    		LDA	AN0OFF
0221   D0F1 AD 5A C0    		LDA	AN1OFF
0222   D0F4 A0 05       		LDY	#5
0223   D0F6 20 B4 FB    		JSR	GOTOCX
0224   D0F9 AD FF CF    		LDA	CLRROM
0225   D0FC 20 72 D1    		JSR	_DUMBELL	;FIRST DIFFERENT SPEAKER BEEP
0226   D0FF AD 01 20    		LDA	SAVEKEY		;WAS A POWER UP IF NO KEY DOWN
0227   D102 30 3B       		BMI	_NOHELLO
0228   D104             ;		JSR	_DUMBELL	;SECOND DIFFERENT SPEAKER BEEP
0229   D104 AD 01 20    		LDA 	SAVEKEY
0230   D107 29 7F       		AND	#$7F		;DON'T CARE ABOUT MSB
0231   D109 C9 41       		CMP	#$41		;MASK LETTERS INTO CONTROL CODE 
0232   D10B 90 02       		BCC	_LESS		;BCC    *+4  BRANCH AHEAD 4 BYTES FROM PROG COUNTER
0233   D10D 29 1F       		AND	#$1F
0234   D10F A8          _LESS		TAY			;I CORRECTED THIS LINE 12-18-2025
0235   D110 C0 03       		CPY	#$03		;C?
0236   D112 F0 41       		BEQ	_RESET.C	;CATALOG THE DISK IF C KEY DOWN
0237   D114 A2 03       		LDX	#3
0238   D116 BD 53 AA    _LINKLP1	LDA	DOSCSWL,X	;IF CSW AND KSW ARE EQUAL
0239   D119 D5 36       		CMP	CSWL,X		;TO DOSCSW AND DOSKSW
0240   D11B D0 0D       		BNE	_LINKDNE	;ASSUME DOS WAS IN USE
0241   D11D CA          		DEX			;AND RECONNECT DOS
0242   D11E 10 F6       		BPL	_LINKLP1	;THIS ONLY MATTERS IN BOOTLESS
0243   D120 A2 03       		LDX	#3		;RESETS SUCH AS CONTRPOL-I
0244   D122 BD BF D0    _LINKLP2	LDA	_DOSLINK,X	;THE PURPOSE IS TO PREVENT
0245   D125 95 36       		STA	CSWL,X		;A CONTROL-I RESET FROM
0246   D127 CA          		DEX			;DISCONNECTING DOS
0247   D128 10 F8       		BPL	_LINKLP2
0248   D12A EA          _LINKDNE	NOP	
0249   D12B C0 0D       		CPY	#$0D		;m ??
0250   D12D F0 40       		BEQ	_RESET.M	;GO TO MONITOR
0251   D12F A9 1B       		LDA	#$1B		;NO HELLO FLAG
0252   D131 48          		PHA
0253   D132 C0 02       		CPY	#$02		;B ??
0254   D134 F0 0C       		BEQ	_RESET.B	;BOOT ONLY
0255   D136 68          		PLA
0256   D137 A9 00       		LDA	#$0		;DO HELLO FLAG
0257   D139 48          		PHA
0258   D13A C0 08       		CPY	#$08		;H ??
0259   D13C F0 04       		BEQ	_RESET.B	;MOVE DOS - WAS _DOMOVE BRANCH
0260   D13E 68          		PLA
0261   D13F A9 1B       _NOHELLO	LDA	#$1B		;NO HELLO FLAG
0262   D141 48          		PHA
0263   D142 20 84 D1    _RESET.B	JSR	_MOVEDOS	;XFER DOS
0264   D145 68          		PLA			;GET DO HELLO FLAG
0265   D146 8D 5F AA    		STA	DOSCMDX
0266   D149 A9 01       		LDA	#<DOSSTRT	;COLD START IS $B73B
0267   D14B 48          		PHA
0268   D14C A9 00       		LDA	#>DOSSTRT
0269   D14E 48          		PHA
0270   D14F 20 B3 D1    _DONORM		JSR	_SETTEXT
0271   D152 4C C4 D1    		JMP	_GOMRBRD
0272   D155             ;
0273   D155             ;
0274   D155 A2 03       _RESET.C	LDX	#3		;SET CSW AND KSW TO I/O ROUTS
0275   D157 BD 53 AA    _CATLP		LDA	DOSCSWL,X
0276   D15A 95 36       		STA	CSWL,X
0277   D15C CA          		DEX
0278   D15D 10 F8       		BPL	_CATLP
0279   D15F             ;		LDA	DOSWRMLO	;LOCATION $3D0
0280   D15F             ;		PHA			;WARM START DOS AFTER CATALOG
0281   D15F             ;		LDA	DOSWRMHI
0282   D15F             ;		PHA
0283   D15F             ;		LDA	CATALOGLO	;$A56E (DO CATALOG)
0284   D15F             ;		PHA
0285   D15F             ;		LDA	CATALOGHI
0286   D15F             ;		PHA
0287   D15F A5 D8       		LDA	ONERR		;FIX APPLESOFT ONERR FLAG
0288   D161 29 7F       		AND	#$7F		;SO DISKI/O ERROR WILL PRINT
0289   D163 85 D8       		STA	ONERR		;
0290   D165 A9 01       		LDA	#1		;FIX NO BUFFER FLAG FOR CATALOG
0291   D167 85 45       		STA	BFFRFLG
0292   D169             ;		JSR	CATALOG
0293   D169             ;		JSR	DOSWARM
0294   D169 20 B3 D1    		JSR	_SETTEXT
0295   D16C 4C C4 D1    		JMP	_GOMRBRD	;EXIT DOS HOSS
0296   D16F             ;
0297   D16F             ;
0298   D16F             ;
0299   D16F             ;		JMP	$FF59
0300   D16F 4C C4 D1    _RESET.M		JMP	_GOMRBRD	;EXIT DOS HOSS
0301   D172             ;
0302   D172             ;
0303   D172             ;
0304   D172             ;		
0305   D172             ;_NMISRCE	DW	$3FB
0306   D172             ;		DW	$FA62
0307   D172             ;
0308   D172             ;
0309   D172             ;
0310   D172 A0 16       _DUMBELL	LDY	#$16		;SLIGHTLY DIFFERENT BELL SOUND
0311   D174 A2 08       _BELP1		LDX	#8
0312   D176 98          _BELP2		TYA
0313   D177 20 A8 FC    		JSR	WAIT
0314   D17A AD 30 C0    		LDA	SPEAKER		;WRITE $C030 LOCATION
0315   D17D CA          		DEX			;
0316   D17E D0 F6       		BNE	_BELP2
0317   D180 88          		DEY
0318   D181 D0 F1       		BNE	_BELP1
0319   D183 60          		RTS
0320   D184             ;
0321   D184             ;
0322   D184             ;
0323   D184             ;  Move Dos
0324   D184             ;
0325   D184             ; I changed Sather's code and have everything in the same ROM bank.
0326   D184             ;
0327   D184             ;		DFB	$FF,$FF,$FF	;Not needed since Move Dos is in the same
0328   D184             ;		JSR	_DOSAWAY	;ROM bank.
0329   D184             ;		RTS			;
0330   D184             ;  
0331   D184             ;
0332   D184             ;
0333   D184             ;
0334   D184 A9 00       _MOVEDOS	LDA	#0	
0335   D186 85 06        		STA	SRCE
0336   D188 85 08        		STA	DSTN
0337   D18A A9 9D       		LDA	#$9D
0338   D18C 85 09       		STA	DSTNHI
0339   D18E A9 D4       		LDA	#$D4		;$D400 SHOULD BE START OF DOS IN D000 ROM
0340   D190 85 07       		STA	SRCEHI		;I had to pack the DOS from the original
0341   D192 A0 00       		LDY	#0		;DosHoss ROMs into Bank0 of the Brain Board.
0342   D194 B1 06       _MOVELP2	LDA	(SRCE),Y
0343   D196 91 08       		STA	(DSTN),Y
0344   D198 C8          		INY
0345   D199 D0 F9       		BNE	_MOVELP2
0346   D19B E6 09       		INC	DSTNHI
0347   D19D E6 07       		INC	SRCEHI
0348   D19F A5 07       		LDA	SRCEHI		;I HAD TO CHANGE SATHER'S CODE SINCE I AM PUTTING
0349   D1A1             					;DOS INTO THE BRAIN BOARD ROM AT DIFFERENT MEMORY
0350   D1A1             					;LOCATIONS.
0351   D1A1 C9 F7       		CMP	#$F7		;DOS should end at F6FF THE WAY I AM LOADING FROM ROM.
0352   D1A3 D0 EF       		BNE	_MOVELP2	;SO DO A COMPARE OF THE SRCEHI TO F7 AND BRANCH UNTIL EQUAL
0353   D1A5             ;		 			;CHECKING USING BCC IF SRCEHI IS LESS THAN OR EQUAL TO #$F7
0354   D1A5             ;		
0355   D1A5 A9 60       		LDA	#$60
0356   D1A7 8D 41 9E    		STA	RTSTEMP
0357   D1AA 20 25 9E    		JSR	MOVEP3
0358   D1AD A9 A9       		LDA	#$A9
0359   D1AF 8D 41 9E    		STA	RTSTEMP
0360   D1B2 60          		RTS
0361   D1B3             ;
0362   D1B3             ;
0363   D1B3 A9 FF       _SETTEXT	LDA	#$FF
0364   D1B5 85 32       		STA	$32
0365   D1B7 8D 50 C0    		STA	$C050
0366   D1BA 8D 53 C0    		STA	$C053
0367   D1BD 8D 54 C0    		STA	$C054
0368   D1C0 8D 56 C0    		STA	$C056
0369   D1C3 60          		RTS
0370   D1C4             ;
0371   D1C4             ;		
0372   D1C4             ; Now exit to the Apple Motherboard ROM
0373   D1C4             ;
0374   D1C4             ;Now just pulled these next calls from
0375   D1C4             ;the normal Apple Reset at FFFc.FFFd
0376   D1C4             ;
0377   D1C4             ; Starting here we are writing a small assembly routing into memory starting at $1000.
0378   D1C4             ; Then calling it so that it can exit to the Brain Board. This program will turn off the 
0379   D1C4             ; Brain Board and then clean up various registers before exiting to the screen.
0380   D1C4             ;
0381   D1C4             ;  NOTE: $FB60 CLEARS SCREEN AND PRINTS APPLE ][
0382   D1C4             ;
0383   D1C4 A9 A9       _GOMRBRD	LDA	#$A9
0384   D1C6 8D 00 10    		STA	$1000
0385   D1C9 A9 FF       		LDA	#-1		;SETUP TO CLEAR THE STACK
0386   D1CB 8D 01 10    		STA	$1001
0387   D1CE A9 9A       		LDA	#$9A		;TXS WILL CLEAR THE STACK
0388   D1D0 8D 02 10    		STA	$1002
0389   D1D3 A9 AD       		LDA	#$AD		;
0390   D1D5 8D 03 10    		STA	$1003
0391   D1D8 A9 C1       		LDA	HOFFLOW		;D1 = SLOT 5, C1 = SLOT 4
0392   D1DA             ; Should also be able to get the low byte of the Brain Board slot as such:
0393   D1DA             ;  (#$HOSSOFF & $00FF) replaces HOFFLOW
0394   D1DA             ;
0395   D1DA             ; Interesting observation. If you put this card into the wrong slot, on computer boot
0396   D1DA             ; it displays 'HACKIN FOOL!' instead of Apple ][ and it locks up. Seems to be related to
0397   D1DA             ; when I changed the code above from hard coded slot low byte to using HOFFLOW. The assembler
0398   D1DA             ; saw this as doing a LDA zero page instead of LDA absolute.
0399   D1DA             ;
0400   D1DA             ;
0401   D1DA 8D 04 10    		STA	$1004		;CHANGE HOFFLOW EQU VALUE TO SET SLOT
0402   D1DD A9 C0       		LDA	#$C0		;LDA $C0XX TO TURN OFF BRAIN BOARD
0403   D1DF 8D 05 10    		STA	$1005		;
0404   D1E2 A9 20       		LDA	#$20		;Next I am just doing some Reset stuff
0405   D1E4 8D 06 10    		STA	$1006		;to clean things up after switching from
0406   D1E7 A9 20       		LDA	#$20		;the Brain Board ROM.
0407   D1E9 8D 07 10    		STA	$1007
0408   D1EC A9 11       		LDA	#$11		; JSR SETVIDEO
0409   D1EE 8D 08 10    		STA	$1008		; 
0410   D1F1             ;		
0411   D1F1             ;		
0412   D1F1             ;
0413   D1F1 A9 D8       		LDA	#$D8		;CLD
0414   D1F3 8D 09 10    		STA	$1009
0415   D1F6 A9 20       		LDA	#$20
0416   D1F8 8D 0A 10    		STA	$100A
0417   D1FB A9 84       		LDA	#$84		;
0418   D1FD 8D 0B 10    		STA	$100B
0419   D200 A9 FE       		LDA	#$FE		;
0420   D202 8D 0C 10    		STA	$100C
0421   D205 A9 20       		LDA	#$20		;
0422   D207 8D 0D 10    		STA	$100D
0423   D20A A9 2F       		LDA	#$2F		;
0424   D20C 8D 0E 10    		STA	$100E
0425   D20F A9 FB       		LDA	#$FB		;
0426   D211 8D 0F 10    		STA	$100F
0427   D214 A9 20       		LDA	#$20
0428   D216 8D 10 10    		STA	$1010
0429   D219 A9 93       		LDA	#$93
0430   D21B 8D 11 10    		STA	$1011
0431   D21E A9 FE       		LDA	#$FE
0432   D220 8D 12 10    		STA	$1012
0433   D223 A9 20       		LDA	#$20
0434   D225 8D 13 10    		STA	$1013
0435   D228 A9 89       		LDA	#$89
0436   D22A 8D 14 10    		STA	$1014
0437   D22D A9 FE       		LDA	#$FE
0438   D22F 8D 15 10    		STA	$1015
0439   D232             ;		
0440   D232             ;		
0441   D232 A9 AD       		LDA	#$AD		;LDA ABSOLUTE
0442   D234 8D 16 10    		STA	$1016
0443   D237 A9 01       		LDA	#$01		;LOW BYTE SAVEKEY
0444   D239 8D 17 10    		STA	$1017
0445   D23C A9 20       		LDA	#$20		;HI BYTE SAVEKEY
0446   D23E 8D 18 10    		STA	$1018
0447   D241 A9 C9       		LDA	#$C9		;CMP IMMEDIATE TO $0D CONTROL + M
0448   D243 8D 19 10    		STA	$1019
0449   D246 A9 0D       		LDA	#$0D		;SAVEKEY LOW BYTE
0450   D248 8D 1A 10    		STA	$101A
0451   D24B A9 D0       		LDA	#$D0		;BNE
0452   D24D 8D 1B 10    		STA	$101B
0453   D250 A9 06       		LDA	#$06		;JUMP 6 BYTES FORWARD IF NOT EQUAL
0454   D252 8D 1C 10    		STA	$101C
0455   D255 A9 20       		LDA	#$20		;JMP TO $FF59 WHICH IS THE MONITOR
0456   D257 8D 1D 10    		STA	$101D		;DOS DOES NOT LOAD
0457   D25A A9 EA       		LDA	#$EA		;USE CONTROL + B TO EXIT MONITOR AND LOAD DOS
0458   D25C 8D 1E 10    		STA	$101E
0459   D25F A9 03       		LDA	#$03
0460   D261 8D 1F 10    		STA	$101F
0461   D264 A9 4C       		LDA	#$4C		;
0462   D266 8D 20 10    		STA	$1020
0463   D269 A9 59       		LDA	#$59  		;
0464   D26B 8D 21 10    		STA	$1021
0465   D26E A9 FF       		LDA	#$FF
0466   D270 8D 22 10    		STA	$1022
0467   D273             ;
0468   D273 A9 20       		LDA	#$20		
0469   D275 8D 34 10    		STA	$1034
0470   D278 A9 84       		LDA	#$84
0471   D27A 8D 35 10    		STA	$1035
0472   D27D A9 9D       		LDA	#$9D
0473   D27F 8D 36 10    		STA	$1036
0474   D282 A9 60       		LDA	#$60  
0475   D284 8D 37 10    		STA	$1037
0476   D287             ;
0477   D287             ;
0478   D287 A9 AD       		LDA	#$AD		;LDA ABSOLUTE
0479   D289 8D 23 10    		STA	$1023
0480   D28C A9 01       		LDA	#$01		;LOW BYTE SAVEKEY
0481   D28E 8D 24 10    		STA	$1024
0482   D291 A9 20       		LDA	#$20		;HI BYTE SAVEKEY
0483   D293 8D 25 10    		STA	$1025
0484   D296 A9 C9       		LDA	#$C9		;CMP IMMEDIATE TO $03 CONTROL + C
0485   D298 8D 26 10    		STA	$1026
0486   D29B A9 03       		LDA	#$03		;
0487   D29D 8D 27 10    		STA	$1027
0488   D2A0 A9 D0       		LDA	#$D0		;BNE
0489   D2A2 8D 28 10    		STA	$1028
0490   D2A5 A9 04       		LDA	#$04		;JUMP 4 BYTES FORWARD IF NOT EQUAL
0491   D2A7 8D 29 10    		STA	$1029
0492   D2AA A9 20       		LDA	#$20		;JSR CATALOG
0493   D2AC 8D 2A 10    		STA	$102A
0494   D2AF A9 6E       		LDA	#$6E
0495   D2B1 8D 2B 10    		STA	$102B
0496   D2B4 A9 A5       		LDA	#$A5
0497   D2B6 8D 2C 10    		STA	$102C
0498   D2B9 A9 60       		LDA	#$60
0499   D2BB 8D 2D 10    		STA	$102D
0500   D2BE A9 EA       		LDA	#$EA		;SKIP SETTING TEXT MODE
0501   D2C0 8D 2E 10    		STA	$102E
0502   D2C3 8D 2F 10    		STA	$102F
0503   D2C6 8D 30 10    		STA	$1030
0504   D2C9             ;		
0505   D2C9             ;		
0506   D2C9             ;
0507   D2C9 A9 20       		LDA	#$20
0508   D2CB 8D 31 10    		STA	$1031
0509   D2CE             ;
0510   D2CE A9 00       		LDA	#$00
0511   D2D0 8D 32 10    		STA	$1032
0512   D2D3 A9 11       		LDA	#$11
0513   D2D5 8D 33 10    		STA	$1033
0514   D2D8 A9 20       		LDA	#$20		
0515   D2DA 8D 34 10    		STA	$1034
0516   D2DD A9 84       		LDA	#$84
0517   D2DF 8D 35 10    		STA	$1035
0518   D2E2 A9 9D       		LDA	#$9D
0519   D2E4 8D 36 10    		STA	$1036
0520   D2E7 A9 60       		LDA	#$60  
0521   D2E9 8D 37 10    		STA	$1037
0522   D2EC             ;
0523   D2EC             ; PRINT MENU 
0524   D2EC             ; Here we write the strings to the screen. Currently just saying DOS is loaded.
0525   D2EC             ;
0526   D2EC A9 A0       		LDA	#$A0		;LOAD Y
0527   D2EE 8D 00 11    		STA	$1100		;
0528   D2F1 A9 00       		LDA	#$00		;WITH $00  
0529   D2F3 8D 01 11    		STA	$1101
0530   D2F6 A9 A2       		LDA	#$A2		;LOAD X
0531   D2F8 8D 02 11    		STA	$1102
0532   D2FB A9 00       		LDA	#$00		;WITH $00
0533   D2FD 8D 03 11    		STA	$1103
0534   D300 A9 EA       		LDA	#$EA		;NOP
0535   D302 8D 04 11    		STA	$1104
0536   D305 A9 B9       		LDA	#$B9		;LDA ABSOLUTE,Y
0537   D307 8D 05 11    		STA	$1105
0538   D30A A9 00       		LDA	#$00		;LOW BYTE OF MENU
0539   D30C 8D 06 11    		STA	$1106
0540   D30F A9 21       		LDA	#$21		;HIGH BYTE OF MENU
0541   D311 8D 07 11    		STA	$1107
0542   D314 A9 C9       		LDA	#$C9		;CMP
0543   D316 8D 08 11    		STA	$1108
0544   D319 A9 0A       		LDA	#$0A		;COMPARE TO $0A
0545   D31B 8D 09 11    		STA	$1109
0546   D31E A9 F0       		LDA	#$F0		;BEQ IF EQUAL TO RTS		
0547   D320 8D 0A 11    		STA	$110A
0548   D323 A9 08       		LDA	#$08		;JUMP FORWARD 8 BYTES
0549   D325 8D 0B 11    		STA	$110B
0550   D328             ;
0551   D328             ;
0552   D328 A9 9D       		LDA	#$9D		;STA,X
0553   D32A 8D 0C 11    		STA	$110C
0554   D32D A9 01       		LDA	#$01		;LOW BYTE COUT
0555   D32F 8D 0D 11    		STA	$110D
0556   D332 A9 06       		LDA	#$06		;HIGH BYTE COUT
0557   D334 8D 0E 11    		STA	$110E
0558   D337 A9 E8       		LDA	#$E8		;INX
0559   D339 8D 0F 11    		STA	$110F
0560   D33C             ;
0561   D33C             ;
0562   D33C A9 C8       		LDA	#$C8		;INY
0563   D33E 8D 10 11    		STA	$1110
0564   D341 A9 4C       		LDA	#$4C		;JMP
0565   D343 8D 11 11    		STA	$1111 
0566   D346 A9 05       		LDA	#$05		;TO $1105 UNTIL $0A END OF STRING
0567   D348 8D 12 11    		STA	$1112
0568   D34B A9 11       		LDA	#$11
0569   D34D 8D 13 11    		STA	$1113
0570   D350 A9 60       		LDA	#$60		;RTS
0571   D352 8D 14 11    		STA	$1114
0572   D355             ;
0573   D355             ;
0574   D355             ; Here I am trying to initialize the video output
0575   D355             ;
0576   D355 A9 A9       SETVIDEO	LDA	#$A9
0577   D357 8D 20 11    		STA	$1120
0578   D35A A9 FF       		LDA	#$FF
0579   D35C 8D 21 11    		STA	$1121
0580   D35F A9 8D       		LDA	#$8D
0581   D361 8D 22 11    		STA	$1122
0582   D364 A9 32       		LDA	#$32
0583   D366 AD 23 11    		LDA	$1123
0584   D369 A9 A9       		LDA	#$A9
0585   D36B 8D 24 11    		STA	$1124
0586   D36E A9 FF       		LDA	#$FF
0587   D370 8D 25 11    		STA	$1125
0588   D373 A9 8D       		LDA	#$8D
0589   D375 8D 26 11    		STA	$1126
0590   D378 A9 50       		LDA	#$50
0591   D37A 8D 27 11    		STA	$1127
0592   D37D A9 C0       		LDA	#$C0
0593   D37F 8D 28 11    		STA	$1128
0594   D382 A9 8D       		LDA	#$8D
0595   D384 8D 29 11    		STA	$1129
0596   D387 A9 53       		LDA	#$53
0597   D389 8D 2A 11    		STA	$112A
0598   D38C A9 C0       		LDA	#$C0
0599   D38E 8D 2B 11    		STA	$112B
0600   D391             ;
0601   D391 A9 8D       		LDA	#$8D
0602   D393 8D 2C 11    		STA	$112C
0603   D396 A9 54       		LDA	#$54
0604   D398 8D 2D 11    		STA	$112D
0605   D39B A9 C0       		LDA	#$C0
0606   D39D 8D 2E 11    		STA	$112E
0607   D3A0             ;
0608   D3A0 A9 8D       		LDA	#$8D
0609   D3A2 8D 2F 11    		STA	$112F
0610   D3A5 A9 56       		LDA	#$56
0611   D3A7 8D 30 11    		STA	$1130
0612   D3AA A9 C0       		LDA	#$C0
0613   D3AC 8D 31 11    		STA	$1131
0614   D3AF A9 60       		LDA	#$60		;RTS
0615   D3B1 8D 32 11    		STA	$1132
0616   D3B4             ;
0617   D3B4             ;
0618   D3B4 4C 00 10    		JMP	$1000		;JMP 1000  4C 00 03		
0619   D3B7             ;		
0620   D3B7             ;
0621   D3B7             STOP		END			;
0622   D3B7             
0623   D3B7             
0624   D3B7             
0625   D3B7             
0626   D3B7             
0627   D3B7             
0628   D3B7             
0629   D3B7             
0630   D3B7             
0631   D3B7             
0632   D3B7             
0633   D3B7             
0634   D3B7             
0635   D3B7             
0636   D3B7             
0637   D3B7             
0638   D3B7             

ADDR  00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F
-----------------------------------------------------
D000  4C 6F D0 44 4F 53 20 33 2E 33 20 48 41 53 20 42
D010  45 45 4E 20 4C 4F 41 44 45 44 21 0A 43 4F 4E 54
D020  52 4F 4C 20 2B 20 43 20 3D 20 43 41 54 41 4C 4F
D030  47 20 44 49 53 4B 2E 0A 43 4F 4E 54 52 4F 4C 20
D040  2B 20 4D 20 3D 20 45 4E 54 45 52 20 4D 4F 4E 49
D050  54 4F 52 2E 0A 43 4F 4E 54 52 4F 4C 20 2B 20 42
D060  20 3D 20 52 45 4C 4F 41 44 20 44 4F 53 2E 0A A2
D070  FF A0 00 A9 00 8D 00 03 B9 03 D0 C9 0A F0 0C 99
D080  00 21 EE 00 03 C8 CA E0 FF D0 ED 99 00 21 C8 A9
D090  00 99 00 21 4C C3 D0 57 4F 52 4B 53 56 38 2E 41
D0A0  53 4D 20 31 2D 32 30 32 36 20 41 75 74 68 6F 72
D0B0  3A 20 4C 65 73 6C 69 65 20 4E 65 77 6D 61 6E BD
D0C0  9E 81 9E AD F3 03 49 A5 CD F4 03 8D F4 03 8D 00
D0D0  20 D0 0E AD 00 C0 8D 01 20 AD 10 C0 AD 01 20 30
D0E0  6E A2 FF 9A D8 20 84 FE 20 2F FB 20 58 FC AD 58
D0F0  C0 AD 5A C0 A0 05 20 B4 FB AD FF CF 20 72 D1 AD
D100  01 20 30 3B AD 01 20 29 7F C9 41 90 02 29 1F A8
D110  C0 03 F0 41 A2 03 BD 53 AA D5 36 D0 0D CA 10 F6
D120  A2 03 BD BF D0 95 36 CA 10 F8 EA C0 0D F0 40 A9
D130  1B 48 C0 02 F0 0C 68 A9 00 48 C0 08 F0 04 68 A9
D140  1B 48 20 84 D1 68 8D 5F AA A9 01 48 A9 00 48 20
D150  B3 D1 4C C4 D1 A2 03 BD 53 AA 95 36 CA 10 F8 A5
D160  D8 29 7F 85 D8 A9 01 85 45 20 B3 D1 4C C4 D1 4C
D170  C4 D1 A0 16 A2 08 98 20 A8 FC AD 30 C0 CA D0 F6
D180  88 D0 F1 60 A9 00 85 06 85 08 A9 9D 85 09 A9 D4
D190  85 07 A0 00 B1 06 91 08 C8 D0 F9 E6 09 E6 07 A5
D1A0  07 C9 F7 D0 EF A9 60 8D 41 9E 20 25 9E A9 A9 8D
D1B0  41 9E 60 A9 FF 85 32 8D 50 C0 8D 53 C0 8D 54 C0
D1C0  8D 56 C0 60 A9 A9 8D 00 10 A9 FF 8D 01 10 A9 9A
D1D0  8D 02 10 A9 AD 8D 03 10 A9 C1 8D 04 10 A9 C0 8D
D1E0  05 10 A9 20 8D 06 10 A9 20 8D 07 10 A9 11 8D 08
D1F0  10 A9 D8 8D 09 10 A9 20 8D 0A 10 A9 84 8D 0B 10
D200  A9 FE 8D 0C 10 A9 20 8D 0D 10 A9 2F 8D 0E 10 A9
D210  FB 8D 0F 10 A9 20 8D 10 10 A9 93 8D 11 10 A9 FE
D220  8D 12 10 A9 20 8D 13 10 A9 89 8D 14 10 A9 FE 8D
D230  15 10 A9 AD 8D 16 10 A9 01 8D 17 10 A9 20 8D 18
D240  10 A9 C9 8D 19 10 A9 0D 8D 1A 10 A9 D0 8D 1B 10
D250  A9 06 8D 1C 10 A9 20 8D 1D 10 A9 EA 8D 1E 10 A9
D260  03 8D 1F 10 A9 4C 8D 20 10 A9 59 8D 21 10 A9 FF
D270  8D 22 10 A9 20 8D 34 10 A9 84 8D 35 10 A9 9D 8D
D280  36 10 A9 60 8D 37 10 A9 AD 8D 23 10 A9 01 8D 24
D290  10 A9 20 8D 25 10 A9 C9 8D 26 10 A9 03 8D 27 10
D2A0  A9 D0 8D 28 10 A9 04 8D 29 10 A9 20 8D 2A 10 A9
D2B0  6E 8D 2B 10 A9 A5 8D 2C 10 A9 60 8D 2D 10 A9 EA
D2C0  8D 2E 10 8D 2F 10 8D 30 10 A9 20 8D 31 10 A9 00
D2D0  8D 32 10 A9 11 8D 33 10 A9 20 8D 34 10 A9 84 8D
D2E0  35 10 A9 9D 8D 36 10 A9 60 8D 37 10 A9 A0 8D 00
D2F0  11 A9 00 8D 01 11 A9 A2 8D 02 11 A9 00 8D 03 11
D300  A9 EA 8D 04 11 A9 B9 8D 05 11 A9 00 8D 06 11 A9
D310  21 8D 07 11 A9 C9 8D 08 11 A9 0A 8D 09 11 A9 F0
D320  8D 0A 11 A9 08 8D 0B 11 A9 9D 8D 0C 11 A9 01 8D
D330  0D 11 A9 06 8D 0E 11 A9 E8 8D 0F 11 A9 C8 8D 10
D340  11 A9 4C 8D 11 11 A9 05 8D 12 11 A9 11 8D 13 11
D350  A9 60 8D 14 11 A9 A9 8D 20 11 A9 FF 8D 21 11 A9
D360  8D 8D 22 11 A9 32 AD 23 11 A9 A9 8D 24 11 A9 FF
D370  8D 25 11 A9 8D 8D 26 11 A9 50 8D 27 11 A9 C0 8D
D380  28 11 A9 8D 8D 29 11 A9 53 8D 2A 11 A9 C0 8D 2B
D390  11 A9 8D 8D 2C 11 A9 54 8D 2D 11 A9 C0 8D 2E 11
D3A0  A9 8D 8D 2F 11 A9 56 8D 30 11 A9 C0 8D 31 11 A9
D3B0  60 8D 32 11 4C 00 10 00 00 00 00 00 00 00 00 00


tasm: Number of errors = 0
